<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Cartografía</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Luchando contra futuras zoonosis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Inicio</a>
</li>
<li>
  <a href="Cartography.html">Producing basic cartographies</a>
</li>
<li>
  <a href="Links.html">Flujos comerciales</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Cartografía</h1>

</div>


<p>Empezamos cargando las librerías que utilizaremos.</p>
<pre class="r"><code>library(tidyverse)
library(sf)
library(ggspatial)
library(readxl)
library(writexl)
library(sf)
library(tidygeocoder)</code></pre>
<div id="creando-un-mapa-de-las-granjas-indsutriales-de-porcino-existentes." class="section level1">
<h1>1 Creando un mapa de las granjas indsutriales de porcino existentes.</h1>
<p>El primer mapa que crearemos será un mapa de las macrogranjas existentes en CLM en 2019.</p>
<p>Primeramente, importamos un excel que contiene las granjas porcinas con al menos 2000 cabezas. Es un excel creado a partir del Censo Porcino de CLM. Lo creé en base a datos de la Junta.</p>
<pre class="r"><code>villages_macrogranjas &lt;- read_excel(&quot;data/porcino +2000.xlsx&quot;)</code></pre>
<p>Segundamente, importamos un shapefile con datos geoespaciales de Castilla-La Mancha (CLM). Un shapefile es un tipo de archivo con información georeferenciada que nos permite, entre otras cosas, dibujar mapas en un ordenador.</p>
<pre class="r"><code>CLM_provinces &lt;- st_read(&quot;data/Provincias.shp&quot;) </code></pre>
<pre><code>## Reading layer `Provincias&#39; from data source 
##   `C:\Victor\Ecologia Politica\ecologia politica paper\PÃ¡gina web\luchando_contra_futuras_zoonosis\data\Provincias.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 5 features and 7 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -5.405995 ymin: 38.02244 xmax: -0.9159556 ymax: 41.32763
## Geodetic CRS:  WGS 84</code></pre>
<p>Para nuestro siguiente paso tenemos que “limpiar” nuestros datos. Como varios pueblos contienen artículos en sus nombres (ex: El Bonillo), vamos a usar la siguiente línea de código para separar el nombre de los pueblos con artículos en dos. Tendremos una columna que contendrá el artículo y otra el municipio sin artículo.</p>
<pre class="r"><code>villages_macrogranjas_municipality_split &lt;- villages_macrogranjas %&gt;% 
  separate(Municipio,c(&quot;MUNICIPIO&quot;,&quot;ARTICULO&quot;),sep=&quot;,&quot;)</code></pre>
<p>Como el lector/la lectora habrá podido observar, el excel con el que estamos trabajando no cuenta con coordenadas. Esto es un problema a la hora de crear un mapa. Afortunadamente, podemos usar el siguiente código para geocodificar automáticamente los pueblos donde existe(n), al menos, una granja con 2000 o más cabezas de porcino. Para realizar la geodificación, estamos solicitando acceso a los datos de Open Street Maps.</p>
<pre class="r"><code>villages_geocoded &lt;- villages_macrogranjas_municipality_split %&gt;%
  geocode(&quot;MUNICIPIO&quot;, method = &#39;osm&#39;, lat = latitude , long = longitude, min_time=2)</code></pre>
<p>Ahora sólo tenemos que representar la información en un mapa. El código que utilizamos para ello no es muy complejo, pero incluye varios pasos. Cada paso está explicado dentro del código.</p>
<pre class="r"><code>CLM_provinces %&gt;% #Aquí le pedimos a R que use como su fuente de datos geospaciales
  # &quot;CLM_provinces&quot;, el shapefile con datos sobre las provincias de CLM.
  ggplot(aes(&quot;gray33&quot;))+ #Aquí le pedimos que use una tonalidad específica de gris para el fondo.
  geom_sf(color = &quot;black&quot;, size = 0.1) + #Aquí le pedimos que dibuje las líneas provinciales en negro
  geom_point(data=villages_geocoded, aes(x=longitude, y=latitude, size=Animales, colour=&quot;pink&quot;, alpha=0.01)) + #Aquí le pedimos que, encima del mapa de las provincias que hemos creado usando CLM_provinces, dibuje
  # un mapa de puntos con información procedente de &quot;villages_geocoded&quot;. Que las coordenadas X de
  # &quot;villages_geocoded&quot; están en la fila &quot;longitude&quot; y las Y en la fila &quot;latitude&quot;. Después,
  # especificamos que queremos que el tamaño de los puntos varié según el valor asignado a cada
  # punto en la columna &quot;Animales&quot;. Finalmente, le decimos que queremos que los puntos sean de color
  # rosa y transparentes.
  annotation_scale(location = &quot;br&quot;, width_hint = 0.5) + #Le pedimos que coloque la escala
  # de nuestro mapa a mano inferior derecha.
  annotation_north_arrow(location = &quot;br&quot;, which_north = &quot;true&quot;, # Le pedimos que coloque una flecha 
                         # de norte, en el lado derecho inferior, que este orientada al norte
                         pad_x = unit(0.75, &quot;in&quot;), pad_y = unit(0.5, &quot;in&quot;),
                         style = north_arrow_fancy_orienteering) + #Especificamos el estilo de la flecha
  coord_sf(xlim = c(-5.5, -0.5), ylim = c(38, 41.30)) + #Le especificamos las coordenadas que queremos
  # que muestre nuestro mapa.
  guides(colour = FALSE, alpha = FALSE)+ #Como las variables de nuestro mapa de puntos 
  # (color=rosa y alpha=0.1) son estéticas, no tiene sentido incluirlas en nuestro mapa.
  # R lo hace automaticamente, nosotros podemos quitarla con este comando
  xlab(&quot;Longitud&quot;)+ #Ahora le pedimos a R que nombre la X como &quot;Longitud&quot;
  ylab(&quot;Latitud&quot;) #Finalmente, pedimos a R que nombre la Y como &quot;Latitud&quot;.</code></pre>
<p><img src="Cartography_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>¡Aquí tenemos nuestro primer mapa!</p>
</div>
<div id="creando-un-mapa-de-las-granjas-indsutriales-de-porcino-proyectadas." class="section level1">
<h1>2 Creando un mapa de las granjas indsutriales de porcino proyectadas.</h1>
<p>Finalmente, vamos a crear un mapa de las granjas industriales de porcino proyectadas en CLM. Los datos provienen del NEVIA, un repositorio de la Junta de CLM que recoge los proyectos de evaluación ambiental. Es una fuente muy útil pero algo incompleta. No siempre determina la cantidad de cabezas que una granja planea tener en las mismas unidades (en ocasiones se usan cabezas y, en otras ocasiones, se usan Unidades Ganaderas Mayores). Por lo tanto, sólo podemos dar información sobre los lugares en los que se han proyectados granjas con 2000 o más cabezas (o bien con su equivalencia en Unidades Ganaderas Mayores).</p>
<pre class="r"><code>projected_macrogranjas &lt;- read_excel(&quot;data/projected_macrogranjas_clean.xlsx&quot;)</code></pre>
<p>Al igual que en último mapa, nuestra base de datos inicial no tienen geocoordenadas. No tenemos que preocuparnos, Open Street Maps nos volverá a sacar de esta situación.</p>
<pre class="r"><code>projected_macrogranjas_geocoded &lt;- projected_macrogranjas %&gt;%
  geocode(&quot;Municipio&quot;, method = &#39;osm&#39;, lat = latitude , long = longitude, min_time=2)</code></pre>
<p>Finalmente, sólo tenemos que crear nuestro segundo mapa.</p>
<pre class="r"><code>CLM_provinces %&gt;%
  ggplot(aes(&quot;gray33&quot;))+
  geom_sf(color = &quot;black&quot;, size = 0.1) +
  geom_point(data=projected_macrogranjas_geocoded, colour=&quot;purple3&quot;, aes(x=longitude, y=latitude, alpha=0.01)) +
  annotation_scale(location = &quot;br&quot;, width_hint = 0.5) +
  annotation_north_arrow(location = &quot;br&quot;, which_north = &quot;true&quot;, 
                         pad_x = unit(0.75, &quot;in&quot;), pad_y = unit(0.5, &quot;in&quot;),
                         style = north_arrow_fancy_orienteering) +
  coord_sf(xlim = c(-5.5, -0.5), ylim = c(38, 41.30)) +
  guides(colour = FALSE, alpha = FALSE)+
  xlab(&quot;Longitud&quot;)+
  ylab(&quot;Latitud&quot;)</code></pre>
<p><img src="Cartography_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
